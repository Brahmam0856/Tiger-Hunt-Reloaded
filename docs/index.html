<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tiger Hunt Multiplayer</title>
  <style>
    canvas {
      border: 2px solid #333;
      background: url('forest-bg.png') no-repeat center;
      background-size: cover;
    }
    #scoreboard {
      margin-top: 10px;
      font-family: Arial, sans-serif;
      font-size: 18px;
      background: #e0ffe0;
      padding: 10px;
      border-radius: 8px;
      width: 400px;
    }
  </style>
</head>
<body>
  <h2>🐅 Tiger Hunt – 2 Player Mode</h2>
  <canvas id="gameCanvas" width="500" height="400"></canvas>
  <div id="scoreboard">Waiting for scores...</div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const hunterImg = new Image();
    const tigerImg = new Image();
    const bloodImg = new Image();
    hunterImg.src = "hunter.png";
    tigerImg.src = "tiger.png";
    bloodImg.src = "blood.png";

    const tigers = [
      { x: 80, y: 90, size: 50 },
      { x: 300, y: 60, size: 50 },
      { x: 200, y: 150, size: 50 }
    ];

    const hunter = { x: 220, y: 300, size: 60 };
    let playerId = "";
    let gameOver = false;

    const ws = new WebSocket("wss://tiger-hunt-backend.dokuparthybrahm.repl.co");

    ws.onmessage = event => {
      const data = JSON.parse(event.data);
      if (data.type === "init") {
        playerId = data.playerId;
        console.log("Connected as", playerId);
      }
      if (data.type === "leaderboard") {
        updateScoreboard(data.scores, data.kills);
      }
      if (data.type === "gameOver") {
        showGameOver(data.kills);
      }
    };

    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      tigers.forEach(t =>
        ctx.drawImage(tigerImg, t.x - 25, t.y - 25, t.size, t.size)
      );
      ctx.drawImage(hunterImg, hunter.x, hunter.y, hunter.size, hunter.size);
    }

    function moveTigers() {
      if (gameOver) return;
      tigers.forEach(t => {
        t.x = Math.random() * (canvas.width - t.size) + t.size / 2;
        t.y = Math.random() * (canvas.height - t.size - 100) + t.size / 2;
      });
      drawScene();
    }

    function showBlood(x, y) {
      ctx.drawImage(bloodImg, x - 15, y - 15, 30, 30);
    }

    canvas.addEventListener("click", e => {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickY = e.clientY - rect.top;
      checkHit(clickX, clickY);
    });

    function checkHit(x, y) {
      let hit = false;
      tigers.forEach(t => {
        const dx = x - t.x;
        const dy = y - t.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist <= t.size / 2) {
          hit = true;
          ws.send(JSON.stringify({ type: "score", playerId, points: 1 }));
          showBlood(t.x, t.y);
          moveTigers();
        }
      });
    }

    function startTimer() {
      let time = 60;
      const interval = setInterval(() => {
        time--;
        if (time <= 0) {
          clearInterval(interval);
          gameOver = true;
          ctx.fillStyle = "red";
          ctx.font = "24px Arial";
          ctx.fillText("🏁 Game Over", 180, 200);
        }
      }, 1000);
    }

    function updateScoreboard(scores, kills) {
      let html = `<strong>🔢 Live Kill Count</strong><br>`;
      for (const id in kills) {
        html += `👤 ${id}: 🐅 ${kills[id]}<br>`;
      }
      document.getElementById("scoreboard").innerHTML = html;
    }

    function showGameOver(kills) {
      let html = `<strong>🏁 Final Results</strong><br>`;
      for (const id in kills) {
        html += `👤 ${id}: 🐅 ${kills[id]} kills<br>`;
      }
      html += `<br>Thanks for hunting!`;
      document.getElementById("scoreboard").innerHTML = html;
    }

    tigerImg.onload = () => {
      drawScene();
      setInterval(moveTigers, 1000); // Speed increased to 1000ms
      startTimer();
    };
  </script>
</body>
</html>