<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tiger Hunt Multiplayer</title>
  <style>
    canvas {
      border: 2px solid #333;
      background: url('forest-bg.png') no-repeat center;
      background-size: cover;
    }
    #scoreboard {
      margin-top: 10px;
      font-family: Arial, sans-serif;
      font-size: 18px;
      background: #e0ffe0;
      padding: 10px;
      border-radius: 8px;
      width: 400px;
    }
    #chatInput {
      margin-top: 10px;
      width: 300px;
      padding: 5px;
    }
    #chatLog {
      margin-top: 10px;
      background: #f5f5f5;
      padding: 8px;
      width: 400px;
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
      height: 100px;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <h2>ğŸ… Tiger Hunt â€“ Multiplayer Arena</h2>
  <canvas id="gameCanvas" width="500" height="400"></canvas>
  <div id="scoreboard">Waiting for scores...</div>

  <input type="text" id="chatInput" placeholder="ğŸ’¬ Send message..." />
  <button onclick="sendChat()">Send</button>
  <div id="chatLog"></div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const hunterImg = new Image();
    const tigerImg = new Image();
    const bloodImg = new Image();

    hunterImg.src = "hunter.png";
    tigerImg.src = "tiger.png";
    bloodImg.src = "blood.png";

    const tigers = [
      { x: 80, y: 90, size: 50 },
      { x: 300, y: 60, size: 50 },
      { x: 200, y: 150, size: 50 }
    ];

    const hunter = { x: 220, y: 300, size: 60 };
    let playerId = "";
    let gameOver = false;

    const ws = new WebSocket("wss://tiger-hunt-backend.dokuparthybrahm.repl.co");

    ws.onmessage = event => {
      const data = JSON.parse(event.data);
      if (data.type === "init") {
        playerId = data.playerId;
      }
      if (data.type === "leaderboard") {
        updateScoreboard(data.scores, data.kills);
      }
      if (data.type === "gameOver") {
        showGameOver(data.kills);
      }
      if (data.type === "chat") {
        showChat(data.playerId, data.message);
      }
    };

    function drawScene() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      tigers.forEach(t =>
        ctx.drawImage(tigerImg, t.x - 25, t.y - 25, t.size, t.size)
      );
      ctx.drawImage(hunterImg, hunter.x, hunter.y, hunter.size, hunter.size);
    }

    function moveTigers() {
      if (gameOver) return;
      tigers.forEach(t => {
        t.x = Math.random() * (canvas.width - t.size) + t.size / 2;
        t.y = Math.random() * (canvas.height - t.size - 100) + t.size / 2;
      });
      drawScene();
    }

    function showBlood(x, y) {
      ctx.drawImage(bloodImg, x - 15, y - 15, 30, 30);
    }

    canvas.addEventListener("click", e => {
      if (gameOver) return;
      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickY = e.clientY - rect.top;
      checkHit(clickX, clickY);
    });

    function checkHit(x, y) {
      tigers.forEach(t => {
        const dx = x - t.x;
        const dy = y - t.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist <= t.size / 2) {
          ws.send(JSON.stringify({ type: "score", playerId, points: 1 }));
          showBlood(t.x, t.y);
          moveTigers();
        }
      });
    }

    function startTimer() {
      let time = 60;
      const interval = setInterval(() => {
        time--;
        if (time <= 0) {
          clearInterval(interval);
          gameOver = true;
          ctx.fillStyle = "red";
          ctx.font = "24px Arial";
          ctx.fillText("ğŸ Game Over", 180, 200);
        }
      }, 1000);
    }

    function updateScoreboard(scores, kills) {
      let html = `<strong>ğŸ”¢ Live Kill Count</strong><br>`;
      for (const id in kills) {
        html += `ğŸ‘¤ ${id}: ğŸ… ${kills[id]}<br>`;
      }
      document.getElementById("scoreboard").innerHTML = html;
    }

    function showGameOver(kills) {
      let html = `<strong>ğŸ Final Results</strong><br>`;
      let highestKills = -1;
      let topHunters = [];

      for (const id in kills) {
        html += `ğŸ‘¤ ${id}: ğŸ… ${kills[id]} kills<br>`;
        if (kills[id] > highestKills) {
          highestKills = kills[id];
          topHunters = [id];
        } else if (kills[id] === highestKills) {
          topHunters.push(id);
        }
      }

      if (highestKills >= 0) {
        const names = topHunters.join(", ");
        html += `<br>ğŸ† Highest Killer${topHunters.length > 1 ? "s" : ""}: <strong>${names}</strong> with <strong>${highestKills}</strong> kills`;
      }

      html += `<br><br>Thanks for hunting!`;
      document.getElementById("scoreboard").innerHTML = html;
    }

    function sendChat() {
      const msg = document.getElementById("chatInput").value;
      if (msg.trim()) {
        ws.send(JSON.stringify({ type: "chat", playerId, message: msg }));
        document.getElementById("chatInput").value = "";
      }
    }

    function showChat(sender, msg) {
      const log = document.getElementById("chatLog");
      log.innerHTML += `<strong>${sender}</strong>: ${msg}<br>`;
      log.scrollTop = log.scrollHeight;
    }

    tigerImg.onload = () => {
      drawScene();
      setInterval(moveTigers, 1000);
      startTimer();
    };
  </script>
</body>
</html>